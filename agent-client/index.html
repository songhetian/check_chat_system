<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        :root {
            --primary-color: #1890ff;
            --danger-color: #ff4d4f;
        }
        body {
            margin: 0;
            padding: 10px;
            overflow: hidden;
            font-family: -apple-system, sans-serif;
            background: transparent;
        }
        /* éœ‡å±åŠ¨ç”» */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shaking {
            animation: shake 0.5s;
            animation-iteration-count: infinite;
            border: 2px solid var(--danger-color) !important;
        }

        .capsule {
            display: flex;
            align-items: center;
            background: rgba(20, 20, 20, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 5px 15px;
            height: 40px;
            color: white;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            -webkit-app-region: drag;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .icon-group {
            display: flex;
            gap: 15px;
            -webkit-app-region: no-drag;
        }
        .icon {
            cursor: pointer;
            font-size: 18px;
            filter: grayscale(1);
            transition: all 0.2s;
        }
        .icon:hover { filter: grayscale(0); transform: scale(1.2); }

        .search-area {
            margin: 0 15px;
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 4px 15px;
            font-size: 12px;
            color: #ccc;
            -webkit-app-region: no-drag;
        }

        /* å¤‡å¿˜å½•å¼¹çª— */
        #memo-panel {
            display: none;
            position: fixed;
            top: 60px;
            left: 10px;
            right: 10px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            color: #333;
            -webkit-app-region: no-drag;
        }
        .memo-input {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .memo-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="capsule" id="main-capsule">
        <div class="icon-group">
            <span class="icon" onclick="toggleMemo()" title="å¤‡å¿˜å½•">ğŸ“</span>
            <span class="icon" onclick="requestHelp()" title="æ±‚åŠ©ä¸»ç®¡">ğŸ†˜</span>
            <span class="icon" title="å¿«æ·è¯æœ¯">ğŸ’¬</span>
        </div>
        <div class="search-area">è¾“å…¥å…³é”®è¯æœè¯æœ¯...</div>
        <div id="status-dot" style="width:8px; height:8px; background:#52c41a; border-radius:50%;"></div>
    </div>

    <!-- å¤‡å¿˜å½•é¢æ¿ -->
    <div id="memo-panel">
        <h4 style="margin: 0 0 10px 0;">å¿«é€Ÿå¤‡å¿˜</h4>
        <input type="text" id="memo-text" class="memo-input" placeholder="è¾“å…¥å¾…åŠäº‹é¡¹...">
        <input type="datetime-local" id="memo-time" class="memo-input">
        <button class="memo-btn" onclick="saveMemo()">æ·»åŠ æé†’</button>
    </div>

    <script src="node_modules/socket.io-client/dist/socket.io.js"></script>
    <script>
        // è¿™é‡Œå‡è®¾å·²ç» npm install äº† socket.io-client
        // å®é™…è¿è¡Œæ—¶éœ€è¦æŒ‡å‘æœåŠ¡ç«¯çš„å±€åŸŸç½‘åœ°å€
        // const socket = io('http://192.168.1.100:3000'); 

        // ç›‘å¬åº•å±‚å¼•æ“å‘æ¥çš„è¿è§„ä¿¡å·
        const { ipcRenderer } = require('electron');
        ipcRenderer.on('on-violation', (event, data) => {
            const capsule = document.getElementById('main-capsule');
            const searchArea = document.querySelector('.search-area');
            
            // å˜çº¢éœ‡åŠ¨
            capsule.classList.add('shaking');
            capsule.style.background = 'rgba(255, 77, 79, 0.9)'; // çº¢è‰²
            searchArea.innerText = `æ‹¦æˆª: ${data.word}`;
            searchArea.style.color = 'white';

            // 3ç§’åæ¢å¤
            setTimeout(() => {
                capsule.classList.remove('shaking');
                capsule.style.background = 'rgba(20, 20, 20, 0.85)';
                searchArea.innerText = 'è¾“å…¥å…³é”®è¯æœè¯æœ¯...';
                searchArea.style.color = '#ccc';
            }, 3000);
        });

        function toggleMemo() {
            const panel = document.getElementById('memo-panel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        }

        function saveMemo() {
            const text = document.getElementById('memo-text').value;
            const time = document.getElementById('memo-time').value;
            if(!text) return alert('è¯·è¾“å…¥å†…å®¹');
            
            // å‘é€åˆ°æœåŠ¡ç«¯ä¿å­˜
            console.log('ä¿å­˜å¤‡å¿˜:', { text, time });
            alert('å¤‡å¿˜å½•å·²è®¾ç½®ï¼Œåˆ°ç‚¹å°†è‡ªåŠ¨æé†’ï¼');
            toggleMemo();
        }

        function requestHelp() {
            const ok = confirm('ç¡®å®šè¦å‘ä¸»ç®¡å‘èµ·ååŠ©è¯·æ±‚å—ï¼Ÿ');
            if(ok) {
                // socket.emit('request-help', { content: 'å®¢æˆ·å¯¹ä»·æ ¼ä¸æ»¡æ„ï¼Œè¯·æ±‚ä»‹å…¥' });
                alert('æ±‚åŠ©è¯·æ±‚å·²å‘é€ï¼Œè¯·ç­‰å¾…ä¸»ç®¡å“åº”ã€‚');
            }
        }

        // æ¨¡æ‹Ÿæ¥æ”¶éœ‡å±
        window.simulateShake = function() {
            const capsule = document.getElementById('main-capsule');
            capsule.classList.add('shaking');
            // æ’­æ”¾æç¤ºéŸ³
            const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');
            audio.play();
            
            setTimeout(() => {
                capsule.classList.remove('shaking');
            }, 3000);
        };
    </script>
</body>
</html>