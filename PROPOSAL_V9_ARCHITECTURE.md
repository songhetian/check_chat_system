# Smart-CS æ•°æ™ºåŒ–è¿è¥æ²»ç†å¹³å° - V9.0 æ¶æ„è®¾è®¡æ–¹æ¡ˆ

## 1. æ ¸å¿ƒæ¶æ„å‡çº§ (Architecture Evolution)

### 1.1 æ··åˆé€šä¿¡æ¶æ„ (Hybrid Communication)
ä¸ºè§£å†³å®æ—¶æ€§ä¸å¤§å¹¶å‘é—®é¢˜ï¼Œç³»ç»Ÿé‡‡ç”¨ **WebSocket + HTTP/2** æ··åˆæ¨¡å¼ã€‚
- **WebSocket (FastAPI)**: ç»´æŒé•¿è¿æ¥ï¼Œè´Ÿè´£å®æ—¶æŒ‡ä»¤ä¸‹å‘ï¼ˆå¦‚ï¼šçª—å£æŠ–åŠ¨ã€å¼ºåˆ¶è¸¢äººã€å±å¹•é”æ­»ï¼‰ã€çŠ¶æ€åŒæ­¥ï¼ˆåå¸­åœ¨çº¿/å¿™ç¢Œï¼‰ã€‚
- **HTTP REST API**: è´Ÿè´£éå®æ—¶çš„å¤§æ•°æ®ä¸Šä¼ ï¼ˆå¦‚ï¼šè§†é¢‘è¯æ®ã€æ—¥å¿—å½’æ¡£ï¼‰ã€‚
- **åº•å±‚é’©å­ (Input Hook)**: å–ä»£é«˜é¢‘æˆªå›¾ OCRï¼Œä½¿ç”¨å†…å­˜çº§é”®ç›˜ç›‘å¬ (`pynput`)ï¼Œå°†æ•æ„Ÿè¯è¯†åˆ«å»¶è¿Ÿä» 2s é™ä½è‡³ 50msã€‚

### 1.2 ç¦»çº¿ç¼“å†²æœºåˆ¶ (Offline Buffer)
- **SQLite (Local DB)**: å®¢æˆ·ç«¯å†…ç½®åŠ å¯† SQLiteã€‚
- **æ–­ç½‘ç­–ç•¥**: ç½‘ç»œä¸­æ–­æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢è‡³ç¦»çº¿æ¨¡å¼ã€‚æ‰€æœ‰è¿è§„è®°å½•ã€æ“ä½œæ—¥å¿—ã€æ±‚åŠ©è¯·æ±‚æš‚å­˜æœ¬åœ° `buffer.db`ã€‚
- **è‡ªåŠ¨åŒæ­¥**: ç½‘ç»œæ¢å¤åï¼Œåå°çº¿ç¨‹é™é»˜æ‰“åŒ…ä¸Šä¼ æ•°æ®ï¼Œç¡®ä¿è¯æ®é“¾å®Œæ•´ã€‚

---

## 2. åŠŸèƒ½æ¨¡å—è¯¦è§£ (Modules)

### 2.1 çµåŠ¨å²›ï¼šæ•°æ™ºæˆ˜æœ¯èƒ¶å›Š (Tactical Capsule)
å‚è€ƒ "OrbSystem" é£æ ¼ï¼Œè®¾è®¡é«˜å¯¹æ¯”åº¦æ‚¬æµ®ç»„ä»¶ã€‚
- **çŠ¶æ€å®šä¹‰**:
    - ğŸ”µ **Blue (Idle)**: ç›‘æ§ä¸­ï¼Œæç®€æ¨¡å¼ã€‚
    - ğŸŸ¡ **Yellow (Assist)**: è”æƒ³è¾“å…¥/æ±‚åŠ©ç­‰å¾…ä¸­ã€‚
    - ğŸ”´ **Red (Alert)**: æ•æ„Ÿè¯è§¦å‘ï¼Œå‘¼å¸ç¯æ•ˆ + çª—å£æŠ–åŠ¨ã€‚
- **äº¤äº’**: æ”¯æŒé¼ æ ‡æ‚¬åœå±•å¼€ï¼Œæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯æˆ–å¿«æ·æ“ä½œï¼ˆä¸€é”®å¤åˆ¶ã€é™éŸ³ï¼‰ã€‚

### 2.2 åå¸­ç«¯ (Agent Client)
- **åº•å±‚ç›‘æ§**: å®æ—¶ç»´æŠ¤è¾“å…¥æµæ»‘åŠ¨çª—å£ï¼ˆWindow Size=20ï¼‰ï¼ŒåŒ¹é…æœ¬åœ°æ•æ„Ÿè¯åº“ã€‚
- **æ•ˆç‡å·¥å…·**:
    - **è”æƒ³è¾“å…¥**: ç›‘æµ‹ `Alt` é”®æˆ–ç‰¹å®šå‰ç¼€ï¼Œå¼¹å‡ºçŸ¥è¯†åº“å»ºè®®ã€‚
    - **ä¸€é”®å¤åˆ¶**: æ¥æ”¶ä¸»ç®¡æŒ‡ä»¤ï¼Œä¸€é”®ä¸Šå±ã€‚
- **æƒ©ç½šæœºåˆ¶**:
    - **çª—å£æŠ–åŠ¨**: `page.window_left` éšæœºåç§»æ¨¡æ‹Ÿå‰§çƒˆéœ‡åŠ¨ã€‚
    - **å¼ºåˆ¶é”å±**: è¦†ç›–å…¨å±é€æ˜ç½®é¡¶çª—å£ï¼Œæ‹¦æˆªæ‰€æœ‰è¾“å…¥ã€‚

### 2.3 ä¸»ç®¡ç«¯ (Supervisor Console)
- **å¤šå¯¹å¤šè°ƒåº¦**:
    - **æ±‚åŠ©é˜Ÿåˆ—**: Redis List ç»´æŠ¤æ±‚åŠ©è¯·æ±‚ï¼Œæ”¯æŒå¤šä¸ªä¸»ç®¡â€œæŠ¢å•â€ã€‚
    - **åä½œæ¨¡å¼**: æ”¯æŒé‚€è¯·ç¬¬äºŒä¸»ç®¡è¿›å…¥â€œä¼šè®®å®¤â€å…±åŒååŠ©ã€‚
- **çŸ¥è¯†åº“é—­ç¯**:
    - **OCR æœç´¢**: æ¥æ”¶å®¢æœæˆªå›¾ -> æœåŠ¡ç«¯ OCR -> åŒ¹é… `knowledge_base`ã€‚
    - **å½’æ¡£**: å¯¹è¯ç»“æŸåï¼Œä¸€é”®å°†è§£å†³æ–¹æ¡ˆæ¸…æ´—å…¥åº“ã€‚

---

## 3. æŠ€æœ¯æ ˆ (Tech Stack)

- **Language**: Python 3.10+
- **UI Framework**: Flet (Flutter based)
- **Backend**: FastAPI (WebSocket/API)
- **Database**: MySQL 8.0 (Main), Redis 7.0 (Cache/Queue), SQLite (Local)
- **Key Libraries**: `pynput` (Input Hook), `sqlalchemy` (ORM), `opencv-python` (Video), `flet` (UI)
- **Packaging**: PyInstaller + Inno Setup

## 4. ç›®å½•ç»“æ„ (Directory Structure)

```text
SmartCS_Desktop/
â”œâ”€â”€ core/                # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ hook_service.py  # é”®ç›˜ç›‘å¬æœåŠ¡
â”‚   â”œâ”€â”€ socket_client.py # WebSocket å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ local_db.py      # SQLite ç®¡ç†
â”‚   â””â”€â”€ hardware.py      # ç¡¬ä»¶æŒ‡çº¹
â”œâ”€â”€ ui/                  # Flet UI ç»„ä»¶
â”‚   â”œâ”€â”€ common/          # å…¬ç”¨ç»„ä»¶ (çµåŠ¨å²›)
â”‚   â”œâ”€â”€ agent/           # åå¸­ç«¯é¡µé¢
â”‚   â””â”€â”€ supervisor/      # ä¸»ç®¡ç«¯é¡µé¢
â”œâ”€â”€ server/              # æœåŠ¡ç«¯ä»£ç  (FastAPI)
â”œâ”€â”€ assets/              # èµ„æºæ–‡ä»¶
â””â”€â”€ main_agent.py        # åå¸­ç«¯å…¥å£
```
