---
name: rbac-integration-guard
description: RBAC æƒé™é›†æˆä¸ SQL è‡ªåŠ¨åŒ–å®ˆå«ã€‚å½“æ–°å¢åŠŸèƒ½ã€API æˆ–é¡µé¢æ—¶ä½¿ç”¨ã€‚å¼ºåˆ¶æ‰§è¡Œæƒé™è‡ªåŠ¨æ³¨å†Œã€HQ è§’è‰²è‡ªåŠ¨æˆæƒåŠ SQL è„šæœ¬è‡ªåŠ¨æ‰§è¡Œ/åŒæ­¥ã€‚
---

# RBAC Integration Guard

## æ ¸å¿ƒåŸåˆ™ (V3.0 åŸå­é¢—ç²’åº¦ç‰ˆ)

åœ¨ Smart-CS Pro ä¸­ï¼Œä»»ä½•ä¸šåŠ¡æ¨¡å—å¿…é¡»ä¸¥æ ¼éµå¾ª **åŸå­çº§ CRUD æƒè´£æ¨¡å‹**ã€‚

### 1. åŸå­æƒè´£æ‹†åˆ†çº¢çº¿ (å¼ºåˆ¶)
ç¦æ­¢ä½¿ç”¨ `manage` è¿™ç§æ¨¡ç³Šæƒé™ã€‚æ‰€æœ‰æ¨¡å—ï¼ˆéƒ¨é—¨ã€ç”¨æˆ·ã€ç­–ç•¥ã€èµ„äº§ç­‰ï¼‰å¿…é¡»ç‰©ç†æ‹†åˆ†ä¸ºä»¥ä¸‹å››ä¸ªç‹¬ç«‹æƒé™ç‚¹ï¼š
*   **`:view` (é˜…)**ï¼šä»…å…è®¸ GET ç±»åˆ—è¡¨ä¸è¯¦æƒ…æŸ¥çœ‹ã€‚
*   **`:create` (å¢)**ï¼šä»…å…è®¸æ–°å¢ç‰©ç†è®°å½•çš„æ“ä½œã€‚
*   **`:update` (æ”¹)**ï¼šä»…å…è®¸å¯¹ç°æœ‰è®°å½•æ‰§è¡Œç‰©ç†æ›´æ–°ã€‚
*   **`:delete` (åˆ )**ï¼šä»…å…è®¸æ‰§è¡Œç‰©ç†æ³¨é”€æˆ–é€»è¾‘åˆ é™¤ã€‚

### 2. å¼€å‘å³æˆæƒçº¢çº¿ (å¼ºåˆ¶)
*   **å…¨é‡æ³¨å†Œ**ï¼šæ¯æ–°å¢ä¸€ä¸ªä¸šåŠ¡å®ä½“ï¼Œå¿…é¡»ç«‹å³åœ¨ `permissions` è¡¨ä¸­ç”Ÿæˆ **4 æ¡** å¯¹åº”çš„ CRUD è®°å½•ã€‚
*   **æ€»éƒ¨ç‰¹æƒè‡ªåŠ¨å¯¹é½**ï¼šæ‰€æœ‰æ–°å¢çš„ `:create`, `:update`, `:delete` æƒé™å¿…é¡»åŒæ­¥æˆäºˆ `role_id=3` (æ€»éƒ¨)ã€‚
*   **åç«¯ç‰©ç†ç†”æ–­**ï¼šAPI æ¥å£å¿…é¡»ç²¾å‡†å¯¹åº” `check_permission`ã€‚ä¾‹å¦‚ `POST /add` å¿…é¡»ç»‘å®š `:create`ï¼Œè€Œé `:update`ã€‚

### 3. è„šæœ¬å›ºåŒ–çº¢çº¿
æ‰€æœ‰æƒè´£å®šä¹‰çš„å˜æ›´å¿…é¡»ç‰©ç†è¿½åŠ åˆ° `central_production.sql`ï¼Œç¡®ä¿ç¯å¢ƒé‡å»ºæ—¶æ¶æ„ 100% å¯¹é½ã€‚

### 2. SQL è‡ªåŠ¨åŒ–æ‰§è¡Œå·¥ä½œæµ
*   **çƒ­æ›´æ–°**ï¼šå®Œæˆ SQL ç¼–å†™åï¼Œä¼˜å…ˆå°è¯•ä½¿ç”¨ `run_shell_command` é€šè¿‡ `mysql` å‘½ä»¤è¡Œç›´æ¥æ‰§è¡Œè¯¥ SQL ç‰‡æ®µã€‚
*   **é‡ç½®ç­–ç•¥**ï¼šå¦‚æœæ¶æ„å˜æ›´è¿‡äºå¤æ‚å¯¼è‡´æ‰§è¡Œå¤±è´¥ï¼Œåœ¨å¾å¾—ç”¨æˆ·åŒæ„æˆ–ä¸ºäº†ä¿æŒç¯å¢ƒä¸€è‡´æ€§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ‰§è¡Œ `DROP DATABASE` å¹¶é‡æ–°è¿è¡Œå…¨é‡ `central_production.sql`ã€‚

## æ“ä½œæŒ‡å—

### åœºæ™¯ Aï¼šæ–°å¢åŠŸèƒ½ç‚¹ï¼ˆä»¥æ–°å¢â€œå®æ—¶å½•éŸ³ååŠ©â€ä¸ºä¾‹ï¼‰
1.  **æ ‡è¯†å®šä¹‰**ï¼šç¡®å®šä»£ç ä¸º `command:voice:assist`ã€‚
2.  **ç”Ÿæˆ DDL/DML**ï¼š
    *   `INSERT INTO permissions (code, name, module) VALUES ('command:voice:assist', 'å®æ—¶å½•éŸ³ååŠ©', 'å®æ—¶æŒ‡æŒ¥');`
    *   `INSERT INTO role_permissions (role_id, permission_code) VALUES (3, 'command:voice:assist');`
3.  **è‡ªåŠ¨æ‰§è¡Œ**ï¼š
    *   è¯»å– `.env` ä¸­çš„ DB é…ç½®ã€‚
    *   è°ƒç”¨ `run_shell_command` æ‰§è¡Œ SQLã€‚
4.  **åŒæ­¥ä¸»è„šæœ¬**ï¼šå°†ä¸Šè¿°è¯­å¥è¿½åŠ è‡³ `central_production.sql`ã€‚

### åœºæ™¯ Bï¼šAPI æƒé™æ ¡éªŒ
*   åœ¨ API é€»è¾‘ä¸­ï¼Œå¿…é¡»å¼ºåˆ¶æ ¡éªŒ `current_user["role_id"]` æˆ–æ£€æŸ¥ `role_permissions` å…³è”ã€‚

## ç¤ºä¾‹ (è‡ªåŠ¨åŒ–åé¦ˆ)

> ğŸš€ **æˆ˜æœ¯åŠŸèƒ½å·²åŒæ­¥ï¼š**
> 
> æˆ‘å·²ä¸ºæ‚¨æ–°å¢äº†â€œXXåŠŸèƒ½â€ï¼Œå¹¶æ‰§è¡Œäº†ä»¥ä¸‹è‡ªåŠ¨åŒ–å®ˆå«åŠ¨ä½œï¼š
> 1. åœ¨ `permissions` è¡¨ä¸­æ³¨å†Œäº†æƒé™ç‚¹ã€‚
> 2. **è‡ªåŠ¨ä¸ºæ€»éƒ¨èº«ä»½ï¼ˆHQï¼‰èµ‹äºˆäº†è¯¥åŠŸèƒ½çš„å…¨é‡è®¿é—®æƒã€‚**
> 3. å·²é€šè¿‡å‘½ä»¤è¡Œè‡ªåŠ¨åœ¨ MySQL ä¸­æ‰§è¡Œäº†åŒæ­¥ DDLã€‚
> 4. å˜æ›´å·²å›ºåŒ–è‡³ `central_production.sql`ã€‚
