---
name: rbac-integration-guard
description: RBAC æƒé™é›†æˆä¸Ž SQL è‡ªåŠ¨åŒ–å®ˆå«ã€‚å½“æ–°å¢ž API æŽ¥å£ã€UI é¡µé¢æˆ–èœå•é¡¹æ—¶ä½¿ç”¨ã€‚ç¡®ä¿æ‰€æœ‰æ–°åŠŸèƒ½éƒ½è‡ªåŠ¨æ³¨å†Œåˆ° RBAC ç³»ç»Ÿä¸­ï¼Œå¹¶ç”Ÿæˆå¿…è¦çš„ SQL è„šæœ¬æç¤ºç”¨æˆ·æ‰§è¡Œã€‚
---

# RBAC Integration Guard

## æ ¸å¿ƒåŽŸåˆ™

åœ¨ Smart-CS Pro ä¸­ï¼Œä»»ä½•â€œå¯è§â€æˆ–â€œå¯è°ƒâ€çš„åŠŸèƒ½éƒ½å¿…é¡»å—åˆ° RBACï¼ˆåŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶ï¼‰çš„çº¦æŸã€‚

### 1. è‡ªåŠ¨é›†æˆè§„èŒƒ
*   **åŠŸèƒ½å¯¹é½**ï¼šæ–°å¢žé¡µé¢å¿…é¡»åœ¨æ•°æ®åº“çš„èœå•/æƒé™è¡¨ä¸­æ³¨å†Œã€‚
*   **API ä¿æŠ¤**ï¼šæ‰€æœ‰æ–°å¢žæŽ¥å£å¿…é¡»æ˜Žç¡®æ‰€å±žçš„è§’è‰²èŒƒå›´ï¼ˆAGENT, ADMIN, HQï¼‰ã€‚
*   **SQL åŒæ­¥**ï¼šå¦‚æžœæ–°åŠŸèƒ½éœ€è¦ä¿®æ”¹æ•°æ®åº“ç»“æž„æˆ–æ’å…¥åˆå§‹æƒé™æ•°æ®ï¼Œ**å¿…é¡»**ç”Ÿæˆå¯¹åº”çš„ SQL è„šæœ¬ã€‚

### 2. MySQL DDL å…¼å®¹æ€§çº¢çº¿ (å¼ºåˆ¶)
*   **ä¸¥ç¦è¯­æ³•**ï¼š**ç¦æ­¢åœ¨ `ALTER TABLE ... ADD COLUMN` ä¸­ä½¿ç”¨ `IF NOT EXISTS` å…³é”®å­—**ï¼ˆæ ‡å‡† MySQL ä¸æ”¯æŒæ­¤è¯­æ³•ï¼‰ã€‚
*   **æ ‡å‡†æ ¼å¼**ï¼š
    *   æ–°å¢žå­—æ®µï¼š`ALTER TABLE è¡¨å ADD COLUMN å­—æ®µå ç±»åž‹ çº¦æŸ;`
    *   æ–°å¢žå¤–é”®ï¼š`ALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®å FOREIGN KEY (å­—æ®µ) REFERENCES å…³è”è¡¨(ID);`
*   **è‡ªæ„ˆåŽŸåˆ™**ï¼šå¦‚æžœæç¤ºç”¨æˆ·æ‰§è¡Œå¤±è´¥ï¼Œå¿…é¡»ç«‹å³æ£€æŸ¥å¹¶æä¾›æ— æ¡ä»¶æ‰§è¡Œçš„ DDL è¯­å¥ã€‚

## æ“ä½œæŒ‡å—

### åœºæ™¯ Aï¼šæ–°å¢ž UI é¡µé¢/èœå•
1.  **å®šä¹‰æƒé™æ ‡è¯†**ï¼šä¸ºæ–°é¡µé¢ç¡®å®šä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆå¦‚ `sys:audit:view`ï¼‰ã€‚
2.  **ç”Ÿæˆä¸ŽåŒæ­¥ SQL**ï¼š
    *   åœ¨ `SmartCS_Desktop/smart-cs-pro/core_engine/database/` ä¸‹ç”Ÿæˆä¸€ä¸ªæ–°çš„ SQL æ–‡ä»¶ã€‚
    *   **æ ¸å¿ƒè¦æ±‚**ï¼šå¦‚æžœæ˜¯æ–°å»ºè¡¨æˆ–ä¿®æ”¹è¡¨ç»“æž„çš„ DDL è¯­å¥ï¼Œ**å¿…é¡»åŒæ­¥è¿½åŠ **åˆ° `SmartCS_Desktop/smart-cs-pro/core_engine/database/central_production.sql` æ–‡ä»¶çš„æœ«å°¾ï¼ˆæˆ–ç›¸åº”æ³¨é‡Šæ®µè½ä¹‹åŽï¼‰ã€‚
    *   **ç¤ºä¾‹ SQL**ï¼š`INSERT INTO menu_config (name, path, role) VALUES ('æ–°åŠŸèƒ½', '/new-page', 'HQ');`
3.  **å¼ºåˆ¶æç¤º**ï¼šåœ¨å›žå¤ç”¨æˆ·æ—¶ï¼Œå¿…é¡»æ˜Žç¡®å‘ŠçŸ¥ï¼šâ€œ**å‘çŽ°æ•°æ®åº“å˜åŠ¨ï¼Œè¯·åœ¨ MySQL ä¸­æ‰§è¡Œä»¥ä¸‹ SQL ä»¥æ¿€æ´»æƒé™ï¼š[SQL ä»£ç å—]**â€ã€‚

### åœºæ™¯ Bï¼šæ–°å¢ž API æŽ¥å£
1.  **è§’è‰²ç¡¬ç¼–ç æ£€æŸ¥**ï¼šåœ¨ API å‡½æ•°å†…éƒ¨æˆ–é€šè¿‡è£…é¥°å™¨ï¼Œæ£€æŸ¥ `current_user["role"]` æ˜¯å¦æœ‰æƒè®¿é—®ã€‚
2.  **éš”ç¦»å®¡è®¡**ï¼šå¦‚æžœæ˜¯ç®¡ç†ç±»æŽ¥å£ï¼Œå¿…é¡»åŒ…å«éƒ¨é—¨ ID è¿‡æ»¤é€»è¾‘ï¼ˆæ•°æ®éš”ç¦»ï¼‰ã€‚

## ç¤ºä¾‹ (SQL æç¤ºè§„èŒƒ)

> ðŸš€ **åŠŸèƒ½å·²å°±ç»ªï¼Œä½†éœ€æ‰§è¡Œæˆ˜æœ¯æŽˆæƒï¼š**
> 
> æ£€æµ‹åˆ°æ–°åŠŸèƒ½â€œå®žæ—¶ä½œæˆ˜å°â€ï¼Œè¯·åŠ¡å¿…åœ¨ MySQL ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹ SQL ä»¥åˆå§‹åŒ–èœå•æƒé™ï¼š
> ```sql
> INSERT INTO permissions (code, name, role) VALUES ('live:command:access', 'å®žæ—¶æŒ‡æŒ¥è®¿é—®', 'ADMIN');
> ```