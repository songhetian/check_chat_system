# Smart-CS Pro 战术级功能规范 (V5.00+)

本文档详细记录了系统在 V5.00 版本引入的核心架构变更与新增战术指令，旨在指导后续的开发与维护。

## 1. 鉴权架构：无状态 JWT 模式
系统已从“内存令牌”全面升级为“无状态 JWT”，以解决服务器重启导致的链路断开问题。

- **核心算法**：HS256 (HMAC with SHA-256)
- **有效期**：默认 7 天（针对 admin 允许战术多开）。
- **校验逻辑**：
  1. 后端拦截器 `get_current_user` 优先执行数学签名验真。
  2. 签名通过后，在 Redis 中检查 `blacklist:{username}` 判定物理撤回状态。
  3. 这种“双重保险”确保了重启服务器不掉线，同时保留了一键踢人的能力。

## 2. 物理干预：链路强制切断 (Force Kill)
在“成员实时监控”页面新增的物理切断功能，用于处理高危违规风险。

- **接口路径**：`/api/admin/force-kill`
- **物理动作**：
  1. 向目标 WebSocket 发送 `TERMINATE_SESSION` 指令。
  2. 在 Redis 中注入 `blacklist:{username}`，有效期 24 小时。
- **UI 触发**：点击成员卡片中的“红色断开”图标。

## 3. SOP 物理加固：多载荷与格式大统一
SOP（业务规范）现在支持并行同步与多种工业格式。

- **多载荷模式**：`content` 字段现在存储 JSON 数组字符串 `["url1", "url2"]`。
- **格式支持清单**：
  - **文档**：.pdf, .doc, .docx, .xlsx, .ppt, .zip
  - **全息载体**：.md (Markdown), .jpg, .png, .mp4 (视频)
- **交互规范**：
  - **拖拽上传**：右侧预览区支持物理文件拖入监听。
  - **并行进度**：基于 XHR 实现多任务并行百分比进度显示。

## 4. 物理安全：Safe Storage
- **本地凭证**：勾选“记住密码”后，密码通过 Electron `safeStorage` 加密后存入 `LocalStorage`。
- **物理绑定**：加密密钥与操作系统钥匙串物理绑定，无法被离线拷贝破解。

---
*注：修改相关逻辑时，必须参考上述规范，严禁回退至有状态 Token 或明文存储模式。*
